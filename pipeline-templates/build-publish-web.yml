parameters:
- name: projectPath
  type: string
  default: '$(Build.SourcesDirectory)/Xbl.Web/Xbl.Web/Xbl.Web.csproj'
- name: buildConfiguration
  type: string
  default: 'Release'
- name: publishDir
  type: string
  default: '$(Build.ArtifactStagingDirectory)/publish'
- name: reactBuildDir
  type: string
  default: 'Xbl.Web/ClientApp/build'
- name: condition
  type: string
  default: 'true'

steps:
- task: CopyFiles@2
  displayName: 'Copy React build to wwwroot'
  condition: ${{ parameters.condition }}
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)/Xbl.Web/${{ parameters.reactBuildDir }}'
    Contents: '**'
    TargetFolder: '$(Build.SourcesDirectory)/Xbl.Web/Xbl.Web/wwwroot'

- task: DotNetCoreCLI@2
  displayName: 'Publish Xbl.Web'
  condition: ${{ parameters.condition }}
  inputs:
    command: 'publish'
    publishWebProjects: false
    projects: '${{ parameters.projectPath }}'
    arguments: '--configuration ${{ parameters.buildConfiguration }} --output ${{ parameters.publishDir }} --no-restore'
    zipAfterPublish: false
